<div class="bg-animation"></div>
<div class="platform-container">
    <header class="platform-header">
        <div class="header-left branding">
            <div class="platform-logo">üöÄ</div>
            <div class="title-container">
                <h1 class="platform-title">Arnes Lernen</h1>
                <p class="platform-subtitle">Spannende Lern-Apps</p>
            </div>
        </div>

        <div class="header-center view-tabs-container">
            <!-- View Switcher (Tabs) -->
            <div class="view-tabs">
                <button class="view-tab" [class.active]="currentView() === 'all'" (click)="setView('all')">
                    Alle Apps
                </button>
                @if (authService.isAuthenticated()) {
                <button class="view-tab" [class.active]="currentView() === 'favorites'" (click)="setView('favorites')">
                    Favoriten
                </button>
                <button class="view-tab" [class.active]="currentView() === 'ai'" (click)="setView('ai')">
                    KI Vorschl√§ge ‚ú®
                </button>
                <button class="view-tab" [class.active]="currentView() === 'plan'" (click)="setView('plan')">
                    üìã Lernplan
                </button>
                }
            </div>
        </div>

        <!-- Auth Controls -->
        <div class="auth-controls">
            @if (authService.loading()) {
            <span class="auth-loading">Laden...</span>
            } @else if (authService.isAuthenticated()) {
            <div class="user-info">
                @if (getSafeAvatarSvg()) {
                <div class="user-avatar-custom" [innerHTML]="getSafeAvatarSvg()"></div>
                } @else if (authService.user()?.photoURL) {
                <img [src]="authService.user()?.photoURL" alt="Avatar" class="user-avatar">
                } @else {
                <div class="user-avatar-placeholder">{{ getDisplayName().charAt(0).toUpperCase() }}</div>
                }
                <span class="user-name">{{ getDisplayName() }}</span>
                <button class="auth-btn badge-btn" (click)="openBadgeShowcase()" title="Abzeichen">
                    <span class="badge-btn-icon">üèÜ</span>
                    @if (badgeService.badges().length > 0) {
                        <span class="badge-count">{{ badgeService.earnedCount }}</span>
                    }
                </button>
                <button id="settings-btn" class="auth-btn settings-btn" (click)="openSettings()"
                    title="Einstellungen"><span class="settings-icon">‚öôÔ∏è</span></button>
                <button class="auth-btn logout-btn" (click)="signOut()" title="Abmelden">üö™</button>
            </div>
            } @else {
            <button id="auth-btn" class="auth-btn login-btn" (click)="openAuthModal()">üîë Anmelden</button>
            }
        </div>
    </header>

    <div class="controls">
        <!-- Category Filters -->
        <div id="category-filters" class="category-filters">
            @for (category of categories(); track category) {
            <button class="category-chip" [class.active]="currentCategory() === category"
                (click)="selectCategory(category)">
                {{ category === 'all' ? 'Alle Kategorien' : category }}
            </button>
            }
        </div>
    </div>

    @if (currentView() === 'ai') {
    <app-learning-view></app-learning-view>
    } @else if (currentView() === 'plan') {
    <app-plan-view></app-plan-view>
    } @else {
    <div class="apps-grid">
        @for (app of filteredApps(); track app.id) {
        <app-app-card [app]="app" [metrics]="getAppMetrics(app.id)" [isFavorite]="favorites().has(app.id)"
            (appClicked)="openApp(app)" (favoriteToggled)="toggleFavorite(app.id)">
        </app-app-card>
        } @empty {
        @if (favoritesLoading() && currentView() === 'favorites') {
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        <div class="skeleton-card"></div>
        } @else {
        <div class="empty-state">
            <p>Keine Apps gefunden.</p>
            @if (currentView() === 'favorites') {
            <p class="sub-text">Markiere Apps mit dem Stern, um sie hier zu sehen.</p>
            }
        </div>
        }
        }
    </div>
    }

    <footer class="platform-footer">
        @if (authService.isAuthenticated()) {
        <p>Angemeldet als: <span class="user-id">{{ authService.user()?.email }}</span></p>
        } @else {
        <p>Your session: <span class="user-id">{{ displayUserId }}</span></p>
        }
        <div class="footer-links" style="margin-top: 1rem; opacity: 0.7; font-size: 0.9rem;">
            <a href="/#/about"
                style="color: inherit; text-decoration: none; border-bottom: 1px dotted currentColor;">√úber
                uns & Datenschutz</a>
        </div>
    </footer>
</div>

<!-- Auth Modal -->
<app-auth-modal></app-auth-modal>

<!-- Properties Modal -->
@if (showPropertiesModal()) {
<app-properties-modal (closed)="closePropertiesModal()"></app-properties-modal>
}

<!-- Badge Showcase Modal -->
@if (showBadgeShowcase()) {
<app-badge-showcase (closed)="closeBadgeShowcase()"></app-badge-showcase>
}