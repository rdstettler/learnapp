<app-learning-app-layout title="üè∑Ô∏è Oberbegriffe" appId="oberbegriffe" [content]="currentItem()">
    <div class="progress-bar">
        <div class="progress-fill" [style.width.%]="progress()"></div>
    </div>

    <div class="card">
        <!-- Welcome Screen -->
        @if (screen() === 'welcome') {
        <div class="welcome-container">
            <div class="welcome-emoji">üè∑Ô∏è</div>
            <h2 style="margin-bottom: 10px;">Oberbegriffe</h2>

            <div class="mode-selector">
                @for (m of modes; track m.id) {
                <button class="mode-btn" [class.active]="mode() === m.id" (click)="setMode(m.id)">
                    <span class="mode-icon">{{ m.icon }}</span>
                    <span class="mode-label">{{ m.label }}</span>
                    <span class="mode-desc">{{ m.description }}</span>
                </button>
                }
            </div>

            <button class="btn btn-primary" (click)="startQuiz()" [disabled]="!dataLoaded()">
                Quiz starten
            </button>
        </div>
        }

        <!-- Quiz: Tippen -->
        @if (screen() === 'quiz' && mode() === 'tippen') {
        <div class="quiz-content">
            <div class="round-info">Aufgabe {{ currentIndex() + 1 }} / {{ PROBLEMS_PER_ROUND }}</div>
            <div class="score-live">
                <div class="score-live-item correct">‚úì {{ totalCorrect() }}</div>
                <div class="score-live-item wrong">‚úó {{ totalWrong() }}</div>
            </div>
            @if (currentItem(); as item) {
            <div class="words-container">
                <div class="words-label">Finde den Oberbegriff f√ºr:</div>
                <div class="words-list">
                    @for (word of item.words; track word) {
                    <span class="word-chip">{{ word }}</span>
                    }
                </div>
            </div>
            <div class="answer-row">
                <input type="text" class="answer-input" [class.correct]="answered() && isCorrect()"
                    [class.incorrect]="answered() && !isCorrect()" [value]="userAnswer()"
                    (input)="updateAnswer($any($event.target).value)" [disabled]="answered()"
                    placeholder="Oberbegriff eingeben..." autocomplete="off">
            </div>
            @if (answered() && !isCorrect()) {
            <div class="correction-hint">
                <span class="correction-label">M√∂gliche Antworten:</span>
                <span class="correction-value">{{ getPossibleAnswers() }}</span>
            </div>
            }
            @if (answered() && isCorrect()) {
            <div class="success-hint">‚úì Richtig! <span class="matched-answer">{{ matchedAnswer() }}</span></div>
            }
            }
            @if (!answered()) {
            <button class="btn btn-primary" [disabled]="!userAnswer()" (click)="checkAnswer()">√úberpr√ºfen</button>
            } @else {
            <button class="btn btn-primary" (click)="nextItem()">
                {{ currentIndex() + 1 >= PROBLEMS_PER_ROUND ? 'Ergebnis anzeigen' : 'Weiter' }}
            </button>
            }
        </div>
        }

        <!-- Quiz: Auswahl (MC) -->
        @if (screen() === 'quiz' && mode() === 'auswahl') {
        <div class="quiz-content">
            <div class="round-info">Aufgabe {{ currentIndex() + 1 }} / {{ PROBLEMS_PER_ROUND }}</div>
            <div class="score-live">
                <div class="score-live-item correct">‚úì {{ totalCorrect() }}</div>
                <div class="score-live-item wrong">‚úó {{ totalWrong() }}</div>
            </div>
            @if (currentItem(); as item) {
            <div class="words-container">
                <div class="words-label">Welcher Oberbegriff passt?</div>
                <div class="words-list">
                    @for (word of item.words; track word) {
                    <span class="word-chip">{{ word }}</span>
                    }
                </div>
            </div>
            <div class="mc-options">
                @for (opt of mcOptions(); track opt) {
                <button class="mc-option-btn" [class]="getMCOptionClass(opt)"
                    [disabled]="mcAnswered()" (click)="selectMCOption(opt)">{{ opt }}</button>
                }
            </div>
            }
            @if (mcAnswered()) {
            <div class="feedback-row">
                @if (mcIsCorrect()) {
                <span class="feedback correct">‚úì Richtig!</span>
                } @else {
                <span class="feedback incorrect">‚úó Richtig w√§re: {{ mcCorrectAnswer() }}</span>
                }
            </div>
            <button class="btn btn-primary" (click)="nextItem()">
                {{ currentIndex() + 1 >= PROBLEMS_PER_ROUND ? 'Ergebnis anzeigen' : 'Weiter' }}
            </button>
            }
        </div>
        }

        <!-- Quiz: Eindringling (OOO) -->
        @if (screen() === 'quiz' && mode() === 'eindringling') {
        <div class="quiz-content">
            <div class="round-info">Aufgabe {{ currentIndex() + 1 }} / {{ PROBLEMS_PER_ROUND }}</div>
            <div class="score-live">
                <div class="score-live-item correct">‚úì {{ totalCorrect() }}</div>
                <div class="score-live-item wrong">‚úó {{ totalWrong() }}</div>
            </div>
            <div class="words-container">
                <div class="words-label">Welches Wort geh√∂rt nicht dazu?</div>
                <div class="ooo-words">
                    @for (word of oooWords(); track word) {
                    <button class="ooo-word-btn" [class]="getOOOWordClass(word)"
                        [disabled]="oooAnswered()" (click)="selectOOOWord(word)">{{ word }}</button>
                    }
                </div>
            </div>
            @if (oooAnswered()) {
            <div class="feedback-row">
                @if (oooIsCorrect()) {
                <span class="feedback correct">‚úì Richtig! ¬´{{ oooIntruder() }}¬ª geh√∂rt zu ¬´{{ oooIntruderCategory() }}¬ª.</span>
                } @else {
                <span class="feedback incorrect">‚úó ¬´{{ oooIntruder() }}¬ª war der Eindringling ({{ oooIntruderCategory() }}).</span>
                }
            </div>
            <button class="btn btn-primary" (click)="nextItem()">
                {{ currentIndex() + 1 >= PROBLEMS_PER_ROUND ? 'Ergebnis anzeigen' : 'Weiter' }}
            </button>
            }
        </div>
        }

        <!-- Results -->
        @if (screen() === 'results') {
        <div class="score-display">
            <div class="score-circle">{{ percentage() }}%</div>
            <p class="score-text">{{ totalCorrect() }} von {{ PROBLEMS_PER_ROUND }} richtig!</p>
            <div class="score-breakdown">
                <div class="score-item correct">
                    <div class="score-item-number">{{ totalCorrect() }}</div>
                    <div class="score-item-label">Richtig</div>
                </div>
                <div class="score-item wrong">
                    <div class="score-item-number">{{ totalWrong() }}</div>
                    <div class="score-item-label">Falsch</div>
                </div>
            </div>
            <div class="result-actions">
                <button class="btn btn-primary" (click)="startQuiz()">Weiter √ºben</button>
                <button class="btn btn-secondary" (click)="restartQuiz()">Zur√ºck</button>
            </div>
        </div>
        }
    </div>
</app-learning-app-layout>